https://stackoverflow.com/questions/44073360
I'm trying to adopt <a href="http://swagger.io/" rel="nofollow noreferrer">Swagger</a> in REST API development (<a href="https://projects.spring.io/spring-boot/" rel="nofollow noreferrer">Spring Boot</a> web application). API documenting process and code generation based on swagger spec works good, and <API label="">now</API> I've faced a problem writing integration tests using <a href="https://github.com/RobWin/assertj-swagger" rel="nofollow noreferrer">assertj-swagger</a> and <a href="http://springfox.github.io/springfox/" rel="nofollow noreferrer">SpringFox</a> libraries.  

A few little words about these libraries. Springfox works by examining an application, once, at runtime to infer API semantics based on Spring configurations, class structure and various compile time java annotations. The swagger-assertj test library should compare a contract-first Swagger YAML file with a code-first Swagger JSON generated by SpringFox. For Consumer Driven Contract tests, assertj-swagger fails a test if it finds missing resources, methods, models, or properties in the implementation which are required by the consumer specification.

My test looks like (test code is taken from <a href="https://github.com/RobWin/assertj-swagger" rel="nofollow noreferrer">GitHub</a> example):

<pre><code>
@RunWith(SpringRunner.class)
@SpringBootTest
public class AssertJSwaggerConsumerDrivenTest {

   @Test
    public void validateThatImplementationSatisfiesConsumerSpecification() {
        String designFirstSwagger = <API label="None">AssertJSwaggerConsumerDrivenTest.class.getResource</API>("/swagger.yaml").<API label="None">getPath</API>();
        <API label="None">SwaggerAssertions.assertThat</API>("http://localhost:8080/v2/api-docs")
                .satisfiesContract(designFirstSwagger);
    }

}

</code></pre>

The problem is that this test is executed for a long time and seems to get stuck cause I don't see any log output after this line:

<pre><code>
INFO c.s.e.AssertJSwaggerConsumerDrivenTest   : Started AssertJSwaggerConsumerDrivenTest in 24.03 seconds (JVM running for 26.774)

</code></pre>


I'm sure that SpringFox is working, cause I see JSON after opening <code>GET http://localhost:8080/v2/api-docs</code> in my browser.  
I have no compile-time or build-time errors when running test, cause Maven resolved dependencies and Spring Boot context is initialized successfully.


Is there anybody experienced in using assertj-swagger cause it looks like I'm doing something wrong?

==========
I've managed to <API label="">run</API> my <code>AssertJSwaggerConsumerDrivenTest</code>! I think I've never been so happy to see a lot of red test results before =) Anyway it's better than running test forever.

AssertJ-Swagger's <a href="https://github.com/RobWin/assertj-swagger/blob/master/README.adoc" rel="nofollow noreferrer">readme</a> is a little bit outdated. Here's what I changed to fix the problem.

Test code:

<pre><code>
@RunWith(SpringRunner.class)
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
public class AssertJSwaggerConsumerDrivenTest {

   @LocalServerPort
    int randomPort;

   @Test
    public void validateThatImplementationSatisfiesConsumerSpecification() {
        File designFirstSwagger = new File(<API label="None">AssertJSwaggerConsumerDrivenTest.class.getResource</API>("/swagger.yaml").<API label="None">getFile</API>());
        <API label="None">SwaggerAssertions.assertThat</API>("http://localhost:" + randomPort + "/v2/api-docs")
                .satisfiesContract(designFirstSwagger.getAbsolutePath());
    }    
}

</code></pre>

pom.xml:

<pre><code>

   io.github.robwin
    assertj-swagger
    0.6.0
    test


   org.assertj
    assertj-core
    3.8.0
    test


   io.swagger
    swagger-parser
    1.0.30
    test


</code></pre>

Also I got <code>java.lang.OutOfMemoryError: Permgen space</code> so I had to add this <code>-XX:MaxPermSize=384m</code> to VM options.

